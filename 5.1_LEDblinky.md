# Lチカ
## 既存プロジェクトを叩き台にする
~~もう夏コミ間近なので~~ SDK内にあるblinkyプロジェクトを叩き台にします。
そのままピン配置の設定だけ変えれば正直動きますが、あえていじります。
```
|- DA1458x_SDK_5.0.3/
.   `- DA1458x_SDK/
.       `- 5.0.3/
.           |- license.txt
.           |- binaries/
.           |- projects/
.           |   |- adc
.           |   |- i2c
.           |   |- shared
.           |   |- systick
.           |   |- timer2
.           |   |- uart2_async
.           |   |- blinky(＊)
.           |   |- quadrature_decoder
.           |   |- spi
.           |   `- timer0
.           |- sdk/
.           `- utilities/
```

## mbedライブラリの移植
### `PinName` / `DigiralIn` / `DigitalOut` / `DigitalInOut`
mbed開発環境では、ターゲットマイクロコントローラのIOピンに`P0_1`や`P1_10`などの
名前を使ってアクセスできるようになっています(`PinName`型)。一方現行のDialog社SDKはマクロと
関数を使ってレジスタにアクセスします。mbed SDKに使われているものと同名の
`pin_names.h`を用意し、定義済マクロ`GPIO_PORT_0`や`GPIO_PIN_0`を使って`PinName`
列挙型を定義します。

Listing: pin\\\_names.h(抜粋)

```{#lst:pin_names_h .cpp .numberLines numbers="left"}
typedef enum {
    P0_0 = (GPIO_PORT_0 << 8) | (GPIO_PIN_0),
    P0_1 = (GPIO_PORT_0 << 8) | (GPIO_PIN_1),
    P0_2 = (GPIO_PORT_0 << 8) | (GPIO_PIN_2),
    P0_3 = (GPIO_PORT_0 << 8) | (GPIO_PIN_3),
    .
    .
    .
    P3_4 = (GPIO_PORT_3 << 8) | (GPIO_PIN_4),
    P3_5 = (GPIO_PORT_3 << 8) | (GPIO_PIN_5),
    P3_6 = (GPIO_PORT_3 << 8) | (GPIO_PIN_6),
    P3_7 = (GPIO_PORT_3 << 8) | (GPIO_PIN_7),
} PinName;
```

いずれかのターゲット向けのmbed_blinkyプロジェクトをオフラインコンパイラ用に
エクスポートし、ヘッダやCソースの内容を~~パクr~~_**大いに参考にして**_
`DigitalIn`/`DigitalOut`クラスを定義します。PinNameを分解して
`GPIO_ConfigurePin()`関数にピン情報を渡します。

<!--
* `GPIO_ConfigurePin(GPIO_PORT port, GPIO_PIN pin, GPIO_PUPD ,,value)`
 -->
Listing: mygpio.cpp(抜粋)

```{#lst:mygpio_cpp .cpp .numberLines numbers="left"}
DigitalOut::DigitalOut(PinName pin){
    _port = (GPIO_PORT)(pin >> 8);
    _pin = (GPIO_PIN)(pin & 0xFF);
    GPIO_ConfigurePin(_port, _pin, OUTPUT, PID_GPIO, false);
}
    .
    .
    .

void DigitalOut::write(int value){
    GPIO_ConfigurePin(_port, _pin, OUTPUT, PID_GPIO, value? 1 : 0);
}
```

### `Serial`

---

+---------------------------------------------------------------------+
| これ以降は章のタイトルを残しておきますが、C90に間に合わないぽいので |
|割愛します。ごめんなさい                                             |
+---------------------------------------------------------------------+

### `wait / wait_ms / wait_us`
### `SPI`
### `W25X40BV`（SPI フラッシュメモリドライバ）
### `AkiSpiLcd`（秋月的メモリ液晶ドライバ）
