
# DA14580をもう少し詳しく
`DA14580`は送受信時5mAの低消費電力を売りにした、Bluetooth Low Energy
規格のトランシーバICです。送受信時5mAは業界最小消費電力^[2016-1-1現在]
らしいです。  
16MHz駆動のARM Cortex-M0マイクロコントローラ、SRAM 42kB, ROM 84kB（ブートローダやBLEスタックが書かれている）、
ワンタイムROM32kB、そしてBLE送受信部を含めた周辺回路で構成されています。

<!--
Features
* Complies with Bluetooth V4.1, ETSI EN 300 328 and
EN 300 440 Class 2 (Europe), FCC CFR47 Part 15
(US) and ARIB STD-T66 (Japan)
* Processing power
* 16 MHz 32 bit ARM Cortex-M0 with SWD interface
* Dedicated Link Layer Processor
* AES-128 bit encryption Processor
* Memories
* 32 kB One-Time-Programmable (OTP) memory
* 42 kB System SRAM
* 84 kB ROM
* 8 kB Retention SRAM
* Power management
* Integrated Buck/Boost DC-DC converter
* P0, P1, P2 and P3 ports with 3.3 V tolerance
* Easy decoupling of only 4 supply pins
* Supports coin (typ. 3.0 V) and alkaline (typ. 1.5 V)
battery cells
* 10-bit ADC for battery voltage measurement
* Digital controlled oscillators
* 16 MHz crystal (±20 ppm max) and RC oscillator
* 32 kHz crystal (±50 ppm, ±500 ppm max) and
RCX oscillator
* General purpose, Capture and Sleep timers
* Digital interfaces
* General purpose I/Os: 14 (WLCSP34 package),
24 (QFN40 package), 32 (QFN48 package)
* 2 UARTs with hardware flow control up to 1 MBd
* SPI+™ interface
* I2C bus at 100 kHz, 400 kHz
* 3-axes capable Quadrature Decoder
* Analog interfaces
* 4-channel 10-bit ADC
* Radio transceiver
* Fully integrated 2.4 GHz CMOS transceiver
* Single wire antenna: no RF matching or RX/TX
switching required
* Supply current at VBAT3V:
TX: 3.4 mA, RX: 3.7 mA (with ideal DC-DC)
* 0 dBm transmit output power
* -20 dBm output power in “Near Field Mode”
* -93 dBm receiver sensitivity
* Packages:
* WLCSP 34 pins, 2.436 mm x 2.436 mm
* QFN 40 pins, 5 mm x 5 mm
* QFN 48 pins, 6 mm x 6 mm
-->

## パッケージ・外観・周辺部品
`DA14580`には３種類のパッケージがあります：

* **0.4ミリピッチWLCSP 34ボール(2.5x2.5mm) - DA14580-01UNA[^1.1]**
* **0.4ミリピッチQFN 40ピン(5.0x5.0mm) - DA14580-01AT2[^1.2]**
* **0.4ミリピッチQFN 48ピン(6.0x6.0mm) - DA14580-01A32[^1.3]**

WLCSPパッケージは外形が2.5ミリ角ですごく小さいです。
40/48ピンQFNは0.4ミリピッチなのでしんどいですがなんとか手ハンダできます。
`DA14580`は1.5V(単3電池)〜3.0V(コイン電池)のバッテリ電圧から内部電源を生成しますが、
電源電圧で周辺部品のつなげ方が変わります。
いずれの場合も2.2uHのインダクタと1uFのコンデンサが必要です。
よくある3.3V系のほうがセンサなどの周辺部品が多いと思うので
個人的にお勧めです。3.3V電源の場合IO電圧も3.3Vになります。
___5VトレラントIOではありません___。5V系のIOに直結すると壊れます。
後述する`村田モジュール`は3.3V系につながるように設計されています。
また、WLCSPパッケージ品を内蔵していますので使用できるIOピンはWLCSPパッケージに準拠します。

## 内蔵周辺回路(ペリフェラル)
ADコンバータは4チャネルまでで割当てピンは固定されていますが、UART、I^2^C、SPIは自由に割り当てることができます。
ロータリエンコーダも同様ですが、2ピン1組で使うので制約があります。

* UART
    * UART,UART2
    * ハードウェアフロー制御もできる
    * 1MBaudまで
* GPIO
    * 最大14 (WLCSP34), 24 (QFN40), 32 (QFN48)個のGPIOピン
* I^2^C
    * 400kHzまで
* SPI
    * 8/9/16/32ビット・ワード
    * マスタ/スレーブ動作
    * 8MHzまで
* 10bit ADC
    * 4ch
    * P0_0〜P0_3に割当てられている
* 汎用タイマー
    * Timer0
    * Timer2
    * SysTick
* キースキャナー
* ロータリエンコーダ・デコーダ（Quadrature decoder）

一通りのサンプルがSDK内の`'projects/target_apps/peripheral_examples/'`以下に用意されています。

## ピン機能一覧表

`Out/pinout_t.md`{.include}

<!--
```include
pinout_t.md
```
-->

<!-- --- -->
[^1.1]: http://www.digikey.jp/product-detail/ja/DA14580-01UNA/1564-1012-1-ND/5113991
[^1.2]: http://www.digikey.jp/product-detail/ja/DA14580-01AT2/1564-1013-1-ND/5113990
[^1.3]: http://www.digikey.jp/product-detail/ja/DA14580-01A32/1564-1014-1-ND/5113994
[^1.4]: Nordicが送受信時5.5mAという新シリーズを出しちゃいました。その新シリーズで旧型番と互換性があるモジュールも登場しました。やばいです(迫真)
